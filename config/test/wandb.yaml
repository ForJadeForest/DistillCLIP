model:
  class_path: DistillModel
  init_args:
    student_encoder:
      class_path: model._image_encoder.ImageEncoder
      init_args:
        is_student: True
        tea_transformer_width: 768
        vit_paras:
          input_resolution: 224
          patch_size: 32
          width: 768
          layers: 4
          heads: 12
          output_dim: 512
    teacher_name: ViT-B/32
    model_type: 'image'
    map_type: 'begin'
    download_root: '/data/pyz/.cache'
    loss_control_para:
      loss_name: [ 'l1', 'kl', 'cos', 'attn', 'hidden', 'emb' ]
      temperature: 2
      loss_scale:
        l1: 10
        emb: 2.5
        attn: 1.5
        hidden: 20
        cos: 10
        kl: 50
      percent:
        l1: 0.2
        emb: 0.05
        attn: 0.2
        hidden: 0.05
        cos: 0.2
        kl: 0.3


data:
  class_path: DistillationDataModule
  init_args:
    num_workers: 0
    dataset: '_dataset'
    batch_size: 128
    kwargs:
      data_dir: '/data/pyz/data'
      dataset_name: 'ImageDataset'
      cache_dir: '/data/pyz/data/cache'
      train_dir: '/home/pyz/combine_dataset/combine_dataset'




trainer:
  auto_select_gpus: True
  accumulate_grad_batches: 1
  accelerator: 'gpu'
  precision: 16
  devices: [ 2 ]
  max_epochs: 100

  log_every_n_steps: 100

  enable_progress_bar: True
  check_val_every_n_epoch: 1
#  val_check_interval: 0.5
  logger:
    class_path: pytorch_lightning.loggers.wandb.WandbLogger
    init_args:
      dir: '/data/pyz/result/Dis_CLIP'
      name : 'test2'
      project: 'Test'
      version: null
      log_model: false
      sync_tensorboard: True

  callbacks:
    - class_path: LearningRateMonitor
    - class_path: ModelSummary
      init_args:
        max_depth: 2
    - class_path: ModelCheckpoint
      init_args:
        filename: '{epoch}-val_acc{hp_metric/stu_acc_top1:.2f}-loss{val/loss}'
        monitor: 'hp_metric/stu_acc_top1'
        save_last: True
        save_top_k: 4
        mode: 'max'
        auto_insert_metric_name: false
    - class_path: ModelCheckpoint
      init_args:
        filename: '{epoch}-val_acc{hp_metric/stu_acc_top1:.2f}-loss{val/loss}'
        monitor: 'val/loss'
        save_last: True
        save_top_k: 4
        mode: 'max'
        auto_insert_metric_name: false

optimizer:
  class_path: AdamW
  init_args:
    lr: 0.0003019951720402019
    weight_decay: 0.01
    eps: 1.0e-8
    amsgrad: true

lr_scheduler:
  class_path: StepLR
  init_args:
    step_size : 20
    gamma : 0.5